<!doctype html><html lang="en"><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><meta name="viewport" content="width=device-width, initial-scale=1" /><link rel="stylesheet" href="/phenomic.browser.7938c57a8c625c788255.css" /><meta data-react-helmet="true" name="generator" content="Phenomic 0.16.2"/><meta data-react-helmet="true" property="og:site_name" content="istanbuljs-website"/><meta data-react-helmet="true" name="twitter:site" content="@"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="Using Istanbul With ES2015+"/><meta data-react-helmet="true" property="og:url" content="http://istanbul.js.org/docs/tutorials/es2015/"/><meta data-react-helmet="true" property="og:description" content="In this tutorial I&#x27;ll walk you through setting up test coverage for your fancy pants ES2015+ JavaScript projects. We&#x27;ll cover two topics:…"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Using Istanbul With ES2015+"/><meta data-react-helmet="true" name="twitter:creator" content="@"/><meta data-react-helmet="true" name="twitter:description" content="In this tutorial I&#x27;ll walk you through setting up test coverage for your fancy pants ES2015+ JavaScript projects. We&#x27;ll cover two topics:…"/><meta data-react-helmet="true" name="description" content="In this tutorial I&#x27;ll walk you through setting up test coverage for your fancy pants ES2015+ JavaScript projects. We&#x27;ll cover two topics:…"/><title data-react-helmet="true">Using Istanbul With ES2015+</title></head><body><div id="phenomic"><div class="_2uLnB" data-reactroot="" data-reactid="1" data-react-checksum="666649060"><!-- react-empty: 2 --><!-- react-empty: 3 --><style data-reactid="4">@-ms-viewport { width: device-width; }</style><header class="_2gGRo" data-reactid="5"><nav class="_2frUm" data-reactid="6"><div class="_37D8R" data-reactid="7"><a class="Ezg15" href="/" data-reactid="8"><img alt="istanbul logo" src="/assets/istanbul-logo.png" class="ENT8c" data-reactid="9"/><span class="_2qOdn" data-reactid="10">istanbul</span></a></div><div class="_3VLYQ" data-reactid="11"><a class="Ezg15" href="/docs/tutorials/" data-reactid="12">Tutorials</a><a class="Ezg15" href="/docs/advanced/" data-reactid="13">Advanced Features</a><a class="Ezg15" href="/contributing/" data-reactid="14">Contributing</a><a class="Ezg15" href="/integrations/" data-reactid="15">Integrations</a><a class="Ezg15" href="https://github.com/istanbuljs/nyc/issues?utf8=%E2%9C%93&amp;q=label%3Aquestion+" data-reactid="16">FAQ</a><!-- react-text: 17 --><!-- /react-text --><a href="https://github.com/istanbuljs" class="Ezg15" data-reactid="18"><span class="SVGInline SVGInline--cleaned" data-reactid="19"><svg class="SVGInline-svg SVGInline--cleaned-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 0C5.374 0 0 5.373 0 12c0 5.302 3.438 9.8 8.207 11.387.6.11.793-.26.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.09-.745.083-.73.083-.73 1.205.085 1.84 1.238 1.84 1.238 1.07 1.834 2.806 1.304 3.49.997.108-.776.42-1.306.763-1.605-2.665-.305-5.467-1.334-5.467-5.93 0-1.312.47-2.382 1.236-3.222-.125-.303-.536-1.524.116-3.176 0 0 1.008-.322 3.3 1.23A11.51 11.51 0 0 1 12 5.803c1.02.005 2.047.138 3.006.404 2.29-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.236 1.91 1.236 3.22 0 4.61-2.807 5.625-5.48 5.922.43.372.824 1.102.824 2.222v3.293c0 .32.192.694.8.576C20.567 21.796 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg></span><!-- react-text: 20 -->GitHub<!-- /react-text --></a></div></nav></header><div class="_2q8yI" data-reactid="21"><div data-reactid="22"><div data-reactid="23"><!-- react-empty: 24 --><div class="_2NPeC _3x8Y9" data-reactid="25"><div class="_2BsDj _28uC5" data-reactid="26"><h1 data-reactid="27">Using Istanbul With ES2015+</h1><div data-reactid="28"><div class="phenomic-BodyContainer" data-reactid="29"><p>In this tutorial I'll walk you through setting up test coverage
for your fancy pants ES2015+ JavaScript projects. We'll cover two topics:
instrumenting native JavaScript code, and writing backwards
compatible ES2015+ code using <a href="https://github.com/babel/babel" target="_blank">babel</a>.</p>
<p>For this tutorial, feel free to follow along in the repository <a href="https://github.com/bcoe/es2015-coverage" target="_blank">bcoe/es2015-coverage</a></p>
<h2 id="es2015-with-babelpreset-env"><a href="#es2015-with-babelpreset-env" class="phenomic-HeadingAnchor">#</a>ES2015+ With <code>@babel/preset-env</code></h2>
<p>ES2015+ is composed of a <a href="https://babeljs.io/docs/plugins/" target="_blank">daunting array</a> of JavaScript language features. Babel comes to the rescue, providing collections of plugins that
track the standardization process.</p>
<p>For this tutorial we will be using the <a href="http://babeljs.io/docs/plugins/preset-env/" target="_blank">env preset</a>, a collection of Babel plugins that
encompass many of the exciting features currently in the pipeline for JavaScript.</p>
<h3 id="prerequisites"><a href="#prerequisites" class="phenomic-HeadingAnchor">#</a>Prerequisites</h3>
<p>By relying on the preset, there are only a few dependencies that we need to add
test coverage to our ES2015 project:</p>
<pre><code class="hljs language-bash">npm i @babel/cli @babel/register babel-plugin-istanbul @babel/preset-env cross-env mocha chai nyc --save-dev</code></pre>
<ul>
<li><code>@babel/cli</code>: is the command-line interface for babel; we use it during the build step.</li>
<li><code>@babel/register</code>: automatically compiles ES2015+ JavaScript as it's required in your
tests.</li>
<li><code>babel-plugin-istanbul</code>: this plugin adds coverage instrumentation to your ES2015+ code
as it's compiled.</li>
<li><code>nyc</code>: outputs the coverage information to disk, and handles running reports.</li>
<li><code>cross-env</code>: used to set <code>NODE_ENV=test</code> in a cross-platform compatible way.</li>
<li><code>mocha</code>/<code>chai</code>: the test framework that I happen to be using for this tutorial.</li>
</ul>
<h3 id="configuration"><a href="#configuration" class="phenomic-HeadingAnchor">#</a>Configuration</h3>
<p><strong>.babelrc</strong></p>
<p>We place a <code>.babelrc</code> in the root of our project which is used by <code>@babel/cli</code>
to apply the compilation process:</p>
<pre><code class="hljs language-json">{
  <span class="hljs-attr">"presets"</span>: [
    <span class="hljs-string">"@babel/preset-env"</span>
  ],
  <span class="hljs-attr">"env"</span>: {
    <span class="hljs-attr">"test"</span>: {
      <span class="hljs-attr">"plugins"</span>: [
        <span class="hljs-string">"istanbul"</span>
      ]
    }
  }
}</code></pre>
<ul>
<li><code>presets</code>: indicates that we should load the <code>@babel/preset-env</code> set of plugins, which is kept up to date for us.</li>
<li><code>env.test.plugins.istanbul</code>: indicates that we should run the <code>babel-plugin-istanbul</code>
plugin only when <code>NODE_ENV=test</code>.</li>
</ul>
<p><strong>package.json: configuring nyc</strong></p>
<pre><code class="hljs language-json">{
  <span class="hljs-attr">"nyc"</span>: {
    <span class="hljs-attr">"require"</span>: [
      <span class="hljs-string">"@babel/register"</span>
    ],
    <span class="hljs-attr">"reporter"</span>: [
      <span class="hljs-string">"lcov"</span>,
      <span class="hljs-string">"text"</span>
    ],
    <span class="hljs-attr">"sourceMap"</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">"instrument"</span>: <span class="hljs-literal">false</span>
  }
}</code></pre>
<ul>
<li><code>nyc.require.@babel/register</code>: indicates that we should automatically run
<code>require('@babel/register')</code> as <code>nyc</code> loads our tests. This allows us to
write ES2015+ code in our tests without running a build step (code is automatically
compiled by babel as it is loaded).</li>
<li><code>nyc.sourceMap=false</code>/<code>nyc.instrument=false</code>: indicates that we should not use
<code>nyc</code> for instrumenting tests with coverage or handling source-maps; this
logic is instead handled by <code>babel</code> and <code>babel-plugin-istanbul</code>.</li>
<li><code>nyc.reporter</code>: A list of reporters that you can use, all of which come from
<a href="https://github.com/istanbuljs/istanbuljs/tree/master/packages/istanbul-reports/lib">istanbul</a>. In this case we telling nyc to ask for an <code>lcov</code> which gives you
a set of html reports for each file instrumented as well as an <code>lcov.info</code> file which can
be sent to coverage services like coveralls.io or codecov.io. The <code>text</code> reporter gives
a table summary of each file's coverage in the terminal.</li>
</ul>
<p><strong>package.json: script stanza</strong></p>
<pre><code class="hljs language-json">{
  <span class="hljs-attr">"scripts"</span>: {
    <span class="hljs-attr">"build"</span>: <span class="hljs-string">"babel index.js -d src"</span>,
    <span class="hljs-attr">"test"</span>: <span class="hljs-string">"cross-env NODE_ENV=test nyc mocha test.js"</span>,
    <span class="hljs-attr">"prepublish"</span>: <span class="hljs-string">"npm run build"</span>
  }
}</code></pre>
<ul>
<li>
<p><code>scripts.test</code>:</p>
<ul>
<li><code>cross-env NODE_ENV=test</code>: sets the <code>NODE_ENV</code> environment variable resulting in the <code>babel-plugin-istanbul</code> plugin being loaded.</li>
<li><code>nyc</code>: indicates that nyc should be used to run <code>mocha</code>.</li>
<li><code>mocha test.js</code>: it doesn't get much simpler than this; use <code>mocha</code> to run
<code>test.js</code>.</li>
</ul>
</li>
<li><code>scripts.build</code>: this script uses <code>babel-cli</code> to compile your ES2015+ code.</li>
<li><code>scripts.prepublish</code>: we automatically run the build step before publishing our
package to npm.</li>
</ul>
<h3 id="writing-tests"><a href="#writing-tests" class="phenomic-HeadingAnchor">#</a>Writing Tests</h3>
<p>Because <code>nyc</code> automatically loads <code>@babel/register</code> there is no
build step necessary for your tests. Just write your tests using
ES2015+ syntax and <code>require()</code> the pre-compiled ES2015+ JavaScript files:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> CoverageBabel <span class="hljs-keyword">from</span> <span class="hljs-string">'./index'</span>

<span class="hljs-built_in">require</span>(<span class="hljs-string">'chai'</span>).should()

describe(<span class="hljs-string">'CoverageBabel'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  it(<span class="hljs-string">'returns hello world message'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">const</span> cls = <span class="hljs-keyword">new</span> CoverageBabel(<span class="hljs-string">'Ben'</span>)
    cls.helloMessage().should.equal(<span class="hljs-string">'hello Ben'</span>)
  })
})</code></pre>
<h3 id="shipping-your-code"><a href="#shipping-your-code" class="phenomic-HeadingAnchor">#</a>Shipping Your Code</h3>
<p>When it's time to publish your code to npm, simply use <code>@babel/cli</code> to compile
your ES2015+ JavaScript into ES5 compatible code:</p>
<p><code>babel index.js -d src</code></p>
<p>This command will read in your ES2015+ <code>./index.js</code> file and output the ES5
<code>./src/index.js</code> file. Only <code>./src/index.js</code> should be published to npm, which
can be achieved by adding a <code>files</code> stanza to your package.json:</p>
<pre><code class="hljs language-json">{
  <span class="hljs-attr">"files"</span>: [
    <span class="hljs-string">"src/index.js"</span>
  ]
}</code></pre>
<h2 id="instrumenting-native-es2015-code"><a href="#instrumenting-native-es2015-code" class="phenomic-HeadingAnchor">#</a>Instrumenting Native ES2015+ Code</h2>
<p>If you're using newer versions's of Node.js various ES2015+ features are already
supported. <a href="http://node.green/" target="_blank">node.green</a> provides
a useful chart for viewing compatibility information.</p>
<p>nyc uses the same parser underneath the hood as babel and understands native
ES2015+ constructs; with zero configuration you can start instrumenting your ES2015+ code!</p>
</div></div></div><section class="_2iNa2" data-reactid="30"></section></div></div></div></div><footer class="_1Ustb" data-reactid="31"><p data-reactid="32"><iframe allowtransparency="true" frameborder="0" scrolling="0" style="width:135px;height:30px;vertical-align:middle;" src="https://ghbtns.com/github-btn.html?user=istanbuljs&amp;repo=nyc&amp;type=star&amp;count=true&amp;size=large" data-reactid="33"></iframe><a href="https://github.com/istanbuljs" data-reactid="34">Istanbul</a><!-- react-text: 35 --> · <!-- /react-text --><!-- react-text: 36 -->v1<!-- /react-text --><!-- react-text: 37 --> · <!-- /react-text --><!-- react-text: 38 -->Revised BSD License<!-- /react-text --></p><p data-reactid="39"><a class="_21LuU" data-reactid="40"><!-- react-text: 41 -->Website generated with <!-- /react-text --><span class="MMp-P" data-reactid="42">&lt;Phenomic /&gt;</span></a></p></footer></div></div><script>window.__COLLECTION__ = [{"layout":"PageError","route":"404.html","description":"Content here not used, see web_modules/layouts/PageError","__filename":"404.md","__url":"/404.html","__resourceUrl":"/404.html","__dataUrl":"/404.html.f3d82a4d938b593823c37ead979b3b86.json"},{"title":"First Post","date":"2016-01-22T00:00:00.000Z","layout":"Post","description":"This is the first post!","__filename":"blog/first-post.md","__url":"/blog/first-post/","__resourceUrl":"/blog/first-post/index.html","__dataUrl":"/blog/first-post/index.html.4a5613b2efb7336faddeb36e490da773.json"},{"title":"Hello World!","date":"2016-02-14T00:00:00.000Z","layout":"Post","description":"Hello there. Here is another dumb post.","__filename":"blog/hello-world.md","__url":"/blog/hello-world/","__resourceUrl":"/blog/hello-world/index.html","__dataUrl":"/blog/hello-world/index.html.71dba0e386497410490147d8e028e650.json"},{"title":"Istanbul Blog","layout":"PostsList","description":"","__filename":"blog/index.md","__url":"/blog/","__resourceUrl":"/blog/index.html","__dataUrl":"/blog/index.html.9883d94018e58fbdb700c0246f5b0454.json"},{"title":"Contributing to Istanbul","description":"We would love to have you contribute to the Istanbul project, be it: creating a detailed bug report. adding a cool new feature. fixing…","__filename":"contributing/index.md","__url":"/contributing/","__resourceUrl":"/contributing/index.html","__dataUrl":"/contributing/index.html.a823c14226ce2bec7a0575222027c1d3.json"},{"metaTitle":"Istanbul, a JavaScript test coverage tool.","superTitle":"JavaScript test coverage made simple.","title":"How Istanbul works","layout":"WithQuickStart","QuickStart":{"title":"mocha","cmd":"mocha"},"description":"Istanbul instruments your ES5 and ES2015+ JavaScript code with line counters, so that you can track how well your unit-tests exercise your…","__filename":"index.md","__url":"/","__resourceUrl":"/index.html","__dataUrl":"/index.html.f5aae3586b78240db46c9fca99ac40d5.json"},{"title":"Tools That Integrate With Istanbul API's","description":"The following tools integrate with Istanbul to provide JavaScript test coverage: nyc: command line tool for instrumenting code with…","__filename":"integrations/index.md","__url":"/integrations/","__resourceUrl":"/integrations/index.html","__dataUrl":"/integrations/index.html.0ccd1eefc7c2f9518a984291512c6909.json"},{"layout":"PageLoading","description":"Content here not used, see web_modules/layouts/PageLoading. This page is a demo for loading state. You can safely delete if you want.","__filename":"loading.md","__url":"/loading/","__resourceUrl":"/loading/index.html","__dataUrl":"/loading/index.html.4f959959ceecdafbb30e2e8fd2869cdc.json"},{"title":"Using Alternative Reporters","layout":"WithQuickStart","QuickStart":{"title":"Using Alternative Reporters"},"description":"By default nyc uses Istanbul's text reporter. However, you may specify an alternative reporter. Below is a list of all available reporters,…","__filename":"docs/advanced/alternative-reporters.md","__url":"/docs/advanced/alternative-reporters/","__resourceUrl":"/docs/advanced/alternative-reporters/index.html","__dataUrl":"/docs/advanced/alternative-reporters/index.html.1861eb6f2680c0a59fd1fcdee8f7cf79.json"},{"title":"Generate report from __coverage__ object","layout":"WithQuickStart","QuickStart":{"title":"Generate report from __coverage__ object"},"description":"Output the contents of window.\\_\\_coverage\\_\\_ (assuming it's in Istanbul 1.0 format) to .nyc_output/out.json. To generate HTML report for…","__filename":"docs/advanced/coverage-object-report.md","__url":"/docs/advanced/coverage-object-report/","__resourceUrl":"/docs/advanced/coverage-object-report/index.html","__dataUrl":"/docs/advanced/coverage-object-report/index.html.63cff6246e2a463a91b388dd603b74f9.json"},{"title":"Advanced `nyc` Features","description":"Instrumenting source files Process tree information Generating report from \\_\\_coverage\\_\\_ object Using Alternative Reporters","__filename":"docs/advanced/index.md","__url":"/docs/advanced/","__resourceUrl":"/docs/advanced/index.html","__dataUrl":"/docs/advanced/index.html.54923dfd8f571bdc13ae258f1d3adee6.json"},{"title":"Instrumenting source files","layout":"WithQuickStart","QuickStart":{"title":"Instrumenting source files"},"description":"nyc's instrument command can be used to instrument source files outside of the context of your unit-tests:","__filename":"docs/advanced/instrument.md","__url":"/docs/advanced/instrument/","__resourceUrl":"/docs/advanced/instrument/index.html","__dataUrl":"/docs/advanced/instrument/index.html.91eb237ec3746772d71d580741acf54a.json"},{"title":"Process Tree information","layout":"WithQuickStart","QuickStart":{"title":"Process Tree information"},"description":"nyc is able to show you all Node processes that are spawned when running a test script under it:","__filename":"docs/advanced/process-tree.md","__url":"/docs/advanced/process-tree/","__resourceUrl":"/docs/advanced/process-tree/index.html","__dataUrl":"/docs/advanced/process-tree/index.html.002f0569aa6f4f697fc98e1d05e5257a.json"},{"title":"Using Istanbul With AVA","layout":"WithQuickStart","QuickStart":{"title":"AVA","cmd":"ava"},"description":"At the end of the day, all you need to do is place the bin nyc in front of the existing test scripts in your package.json: that's it! this…","__filename":"docs/tutorials/ava.md","__url":"/docs/tutorials/ava/","__resourceUrl":"/docs/tutorials/ava/index.html","__dataUrl":"/docs/tutorials/ava/index.html.729a3f46db9f6de3d9eaa0389b2af841.json"},{"title":"Using Istanbul With ES2015+","layout":"WithQuickStart","QuickStart":{"title":"Using Istanbul With ES2015+"},"description":"In this tutorial I'll walk you through setting up test coverage for your fancy pants ES2015+ JavaScript projects. We'll cover two topics:…","__filename":"docs/tutorials/es2015.md","__url":"/docs/tutorials/es2015/","__resourceUrl":"/docs/tutorials/es2015/index.html","__dataUrl":"/docs/tutorials/es2015/index.html.39aa14023c7c2a55e30bf99d9fed405d.json"},{"title":"Tutorials","description":"AVA ES2015+ Jest mocha Intern IoT.js tap TypeScript","__filename":"docs/tutorials/index.md","__url":"/docs/tutorials/","__resourceUrl":"/docs/tutorials/index.html","__dataUrl":"/docs/tutorials/index.html.41391f33f65c642f87d4ea8c8c4c5778.json"},{"title":"Using Istanbul With Intern","layout":"WithQuickStart","QuickStart":{"title":"Using Istanbul With Intern"},"description":"Code coverage, implemented using Istanbul, is a core feature of Intern. Simply indicate which files should be covered using a glob string,…","__filename":"docs/tutorials/intern.md","__url":"/docs/tutorials/intern/","__resourceUrl":"/docs/tutorials/intern/index.html","__dataUrl":"/docs/tutorials/intern/index.html.522ddef21b1f2ab85add395ea2f0d430.json"},{"title":"Using Istanbul With IoT.js","layout":"WithQuickStart","QuickStart":{"title":"Using Istanbul With IoT.js"},"description":"You can also use Istanbul to instrument your IoT.js modules or script files. Since IoT.js is rather minimalistic in design, this will…","__filename":"docs/tutorials/iotjs.md","__url":"/docs/tutorials/iotjs/","__resourceUrl":"/docs/tutorials/iotjs/index.html","__dataUrl":"/docs/tutorials/iotjs/index.html.1185345bd3a02bb6adb6c102f37adc14.json"},{"title":"Using Istanbul With Jest","layout":"WithQuickStart","QuickStart":{"title":"Using Istanbul With Jest"},"description":"Istanbul is built into Jest, so configuration is handled directly by Jest. The report can be generated by triggering jest with the…","__filename":"docs/tutorials/jest.md","__url":"/docs/tutorials/jest/","__resourceUrl":"/docs/tutorials/jest/index.html","__dataUrl":"/docs/tutorials/jest/index.html.5c803423e2ac956877f818989cb8e5d8.json"},{"title":"Using Istanbul With Mocha","layout":"WithQuickStart","QuickStart":{"title":"mocha","cmd":"mocha"},"description":"Istanbul is extensively tested with mocha, which we use for many of our own repos. At the end of the day, all you need to do is place the…","__filename":"docs/tutorials/mocha.md","__url":"/docs/tutorials/mocha/","__resourceUrl":"/docs/tutorials/mocha/index.html","__dataUrl":"/docs/tutorials/mocha/index.html.23ba66c5f2f80688bbf3efa70ff6c5a7.json"},{"title":"Using Istanbul With Node Tap","layout":"WithQuickStart","QuickStart":{"title":"Node Tap"},"description":"Node Tap uses nyc to track code coverage, even across subprocess boundaries. It is included by default, and there’s nothing you need to do…","__filename":"docs/tutorials/tap.md","__url":"/docs/tutorials/tap/","__resourceUrl":"/docs/tutorials/tap/index.html","__dataUrl":"/docs/tutorials/tap/index.html.b0506fec74e8201098ff58e9bd8c3d6f.json"},{"title":"Using Istanbul With TypeScript & mocha","layout":"WithQuickStart","QuickStart":{"title":"Using Istanbul With TypeScript & mocha"},"description":"Thanks to @mohsen1's post the following is the minimum recommended configuration to get accurate TypeScript coverage with mocha. With this…","__filename":"docs/tutorials/typescript.md","__url":"/docs/tutorials/typescript/","__resourceUrl":"/docs/tutorials/typescript/index.html","__dataUrl":"/docs/tutorials/typescript/index.html.afe633be49070554bba0e05075547575.json"},{"title":"Using Istanbul With Webpack","description":"Tutorial coming soon.","__filename":"docs/tutorials/webpack.md","__url":"/docs/tutorials/webpack/","__resourceUrl":"/docs/tutorials/webpack/index.html","__dataUrl":"/docs/tutorials/webpack/index.html.35be98a119eb6b57b014ff2d1757a675.json"}];window.__INITIAL_STATE__ = {"pages":{"/docs/tutorials/es2015/":{"head":{"title":"Using Istanbul With ES2015+","layout":"WithQuickStart","QuickStart":{"title":"Using Istanbul With ES2015+"},"description":"In this tutorial I'll walk you through setting up test coverage for your fancy pants ES2015+ JavaScript projects. We'll cover two topics:…"},"body":"<p>In this tutorial I'll walk you through setting up test coverage\nfor your fancy pants ES2015+ JavaScript projects. We'll cover two topics:\ninstrumenting native JavaScript code, and writing backwards\ncompatible ES2015+ code using <a href=\"https://github.com/babel/babel\" target=\"_blank\">babel</a>.</p>\n<p>For this tutorial, feel free to follow along in the repository <a href=\"https://github.com/bcoe/es2015-coverage\" target=\"_blank\">bcoe/es2015-coverage</a></p>\n<h2 id=\"es2015-with-babelpreset-env\"><a href=\"#es2015-with-babelpreset-env\" class=\"phenomic-HeadingAnchor\">#</a>ES2015+ With <code>@babel/preset-env</code></h2>\n<p>ES2015+ is composed of a <a href=\"https://babeljs.io/docs/plugins/\" target=\"_blank\">daunting array</a> of JavaScript language features. Babel comes to the rescue, providing collections of plugins that\ntrack the standardization process.</p>\n<p>For this tutorial we will be using the <a href=\"http://babeljs.io/docs/plugins/preset-env/\" target=\"_blank\">env preset</a>, a collection of Babel plugins that\nencompass many of the exciting features currently in the pipeline for JavaScript.</p>\n<h3 id=\"prerequisites\"><a href=\"#prerequisites\" class=\"phenomic-HeadingAnchor\">#</a>Prerequisites</h3>\n<p>By relying on the preset, there are only a few dependencies that we need to add\ntest coverage to our ES2015 project:</p>\n<pre><code class=\"hljs language-bash\">npm i @babel/cli @babel/register babel-plugin-istanbul @babel/preset-env cross-env mocha chai nyc --save-dev</code></pre>\n<ul>\n<li><code>@babel/cli</code>: is the command-line interface for babel; we use it during the build step.</li>\n<li><code>@babel/register</code>: automatically compiles ES2015+ JavaScript as it's required in your\ntests.</li>\n<li><code>babel-plugin-istanbul</code>: this plugin adds coverage instrumentation to your ES2015+ code\nas it's compiled.</li>\n<li><code>nyc</code>: outputs the coverage information to disk, and handles running reports.</li>\n<li><code>cross-env</code>: used to set <code>NODE_ENV=test</code> in a cross-platform compatible way.</li>\n<li><code>mocha</code>/<code>chai</code>: the test framework that I happen to be using for this tutorial.</li>\n</ul>\n<h3 id=\"configuration\"><a href=\"#configuration\" class=\"phenomic-HeadingAnchor\">#</a>Configuration</h3>\n<p><strong>.babelrc</strong></p>\n<p>We place a <code>.babelrc</code> in the root of our project which is used by <code>@babel/cli</code>\nto apply the compilation process:</p>\n<pre><code class=\"hljs language-json\">{\n  <span class=\"hljs-attr\">\"presets\"</span>: [\n    <span class=\"hljs-string\">\"@babel/preset-env\"</span>\n  ],\n  <span class=\"hljs-attr\">\"env\"</span>: {\n    <span class=\"hljs-attr\">\"test\"</span>: {\n      <span class=\"hljs-attr\">\"plugins\"</span>: [\n        <span class=\"hljs-string\">\"istanbul\"</span>\n      ]\n    }\n  }\n}</code></pre>\n<ul>\n<li><code>presets</code>: indicates that we should load the <code>@babel/preset-env</code> set of plugins, which is kept up to date for us.</li>\n<li><code>env.test.plugins.istanbul</code>: indicates that we should run the <code>babel-plugin-istanbul</code>\nplugin only when <code>NODE_ENV=test</code>.</li>\n</ul>\n<p><strong>package.json: configuring nyc</strong></p>\n<pre><code class=\"hljs language-json\">{\n  <span class=\"hljs-attr\">\"nyc\"</span>: {\n    <span class=\"hljs-attr\">\"require\"</span>: [\n      <span class=\"hljs-string\">\"@babel/register\"</span>\n    ],\n    <span class=\"hljs-attr\">\"reporter\"</span>: [\n      <span class=\"hljs-string\">\"lcov\"</span>,\n      <span class=\"hljs-string\">\"text\"</span>\n    ],\n    <span class=\"hljs-attr\">\"sourceMap\"</span>: <span class=\"hljs-literal\">false</span>,\n    <span class=\"hljs-attr\">\"instrument\"</span>: <span class=\"hljs-literal\">false</span>\n  }\n}</code></pre>\n<ul>\n<li><code>nyc.require.@babel/register</code>: indicates that we should automatically run\n<code>require('@babel/register')</code> as <code>nyc</code> loads our tests. This allows us to\nwrite ES2015+ code in our tests without running a build step (code is automatically\ncompiled by babel as it is loaded).</li>\n<li><code>nyc.sourceMap=false</code>/<code>nyc.instrument=false</code>: indicates that we should not use\n<code>nyc</code> for instrumenting tests with coverage or handling source-maps; this\nlogic is instead handled by <code>babel</code> and <code>babel-plugin-istanbul</code>.</li>\n<li><code>nyc.reporter</code>: A list of reporters that you can use, all of which come from\n<a href=\"https://github.com/istanbuljs/istanbuljs/tree/master/packages/istanbul-reports/lib\">istanbul</a>. In this case we telling nyc to ask for an <code>lcov</code> which gives you\na set of html reports for each file instrumented as well as an <code>lcov.info</code> file which can\nbe sent to coverage services like coveralls.io or codecov.io. The <code>text</code> reporter gives\na table summary of each file's coverage in the terminal.</li>\n</ul>\n<p><strong>package.json: script stanza</strong></p>\n<pre><code class=\"hljs language-json\">{\n  <span class=\"hljs-attr\">\"scripts\"</span>: {\n    <span class=\"hljs-attr\">\"build\"</span>: <span class=\"hljs-string\">\"babel index.js -d src\"</span>,\n    <span class=\"hljs-attr\">\"test\"</span>: <span class=\"hljs-string\">\"cross-env NODE_ENV=test nyc mocha test.js\"</span>,\n    <span class=\"hljs-attr\">\"prepublish\"</span>: <span class=\"hljs-string\">\"npm run build\"</span>\n  }\n}</code></pre>\n<ul>\n<li>\n<p><code>scripts.test</code>:</p>\n<ul>\n<li><code>cross-env NODE_ENV=test</code>: sets the <code>NODE_ENV</code> environment variable resulting in the <code>babel-plugin-istanbul</code> plugin being loaded.</li>\n<li><code>nyc</code>: indicates that nyc should be used to run <code>mocha</code>.</li>\n<li><code>mocha test.js</code>: it doesn't get much simpler than this; use <code>mocha</code> to run\n<code>test.js</code>.</li>\n</ul>\n</li>\n<li><code>scripts.build</code>: this script uses <code>babel-cli</code> to compile your ES2015+ code.</li>\n<li><code>scripts.prepublish</code>: we automatically run the build step before publishing our\npackage to npm.</li>\n</ul>\n<h3 id=\"writing-tests\"><a href=\"#writing-tests\" class=\"phenomic-HeadingAnchor\">#</a>Writing Tests</h3>\n<p>Because <code>nyc</code> automatically loads <code>@babel/register</code> there is no\nbuild step necessary for your tests. Just write your tests using\nES2015+ syntax and <code>require()</code> the pre-compiled ES2015+ JavaScript files:</p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-keyword\">import</span> CoverageBabel <span class=\"hljs-keyword\">from</span> <span class=\"hljs-string\">'./index'</span>\n\n<span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">'chai'</span>).should()\n\ndescribe(<span class=\"hljs-string\">'CoverageBabel'</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) </span>{\n  it(<span class=\"hljs-string\">'returns hello world message'</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\"></span>) </span>{\n    <span class=\"hljs-keyword\">const</span> cls = <span class=\"hljs-keyword\">new</span> CoverageBabel(<span class=\"hljs-string\">'Ben'</span>)\n    cls.helloMessage().should.equal(<span class=\"hljs-string\">'hello Ben'</span>)\n  })\n})</code></pre>\n<h3 id=\"shipping-your-code\"><a href=\"#shipping-your-code\" class=\"phenomic-HeadingAnchor\">#</a>Shipping Your Code</h3>\n<p>When it's time to publish your code to npm, simply use <code>@babel/cli</code> to compile\nyour ES2015+ JavaScript into ES5 compatible code:</p>\n<p><code>babel index.js -d src</code></p>\n<p>This command will read in your ES2015+ <code>./index.js</code> file and output the ES5\n<code>./src/index.js</code> file. Only <code>./src/index.js</code> should be published to npm, which\ncan be achieved by adding a <code>files</code> stanza to your package.json:</p>\n<pre><code class=\"hljs language-json\">{\n  <span class=\"hljs-attr\">\"files\"</span>: [\n    <span class=\"hljs-string\">\"src/index.js\"</span>\n  ]\n}</code></pre>\n<h2 id=\"instrumenting-native-es2015-code\"><a href=\"#instrumenting-native-es2015-code\" class=\"phenomic-HeadingAnchor\">#</a>Instrumenting Native ES2015+ Code</h2>\n<p>If you're using newer versions's of Node.js various ES2015+ features are already\nsupported. <a href=\"http://node.green/\" target=\"_blank\">node.green</a> provides\na useful chart for viewing compatibility information.</p>\n<p>nyc uses the same parser underneath the hood as babel and understands native\nES2015+ constructs; with zero configuration you can start instrumenting your ES2015+ code!</p>\n","__filename":"docs/tutorials/es2015.md","__url":"/docs/tutorials/es2015/","__resourceUrl":"/docs/tutorials/es2015/index.html","__dataUrl":"/docs/tutorials/es2015/index.html.39aa14023c7c2a55e30bf99d9fed405d.json","type":"WithQuickStart"}}}</script><script data-react-helmet="true" src="https://cdn.polyfill.io/v2/polyfill.min.js"></script><script src="/phenomic.browser.7938c57a8c625c788255.js"></script></body></html>